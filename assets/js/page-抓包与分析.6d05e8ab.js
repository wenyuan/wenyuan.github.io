(window.webpackJsonp=window.webpackJsonp||[]).push([[247],{495:function(t,s,a){t.exports=a.p+"assets/img/ping.c08a7241.png"},496:function(t,s,a){t.exports=a.p+"assets/img/tcpdump-ping.5eabec1b.png"},497:function(t,s,a){t.exports=a.p+"assets/img/ping.pcap.3adc4407.png"},498:function(t,s,a){t.exports=a.p+"assets/img/number1-in-ping.pcap.7c71ac31.png"},499:function(t,s,a){t.exports=a.p+"assets/img/http.pcap.f8d3b238.png"},500:function(t,s,a){t.exports=a.p+"assets/img/tcp-flows-in-http.pcap.7850c688.png"},501:function(t,s,a){t.exports=a.p+"assets/img/cancel-relative-seq.16795c05.png"},502:function(t,s,a){t.exports=a.p+"assets/img/tcp-flows-in-http.pcap-2.d9841815.png"},503:function(t,s,a){t.exports=a.p+"assets/img/tcp-three-handshakes-and-four-waves.583b297b.png"},858:function(t,s,a){"use strict";a.r(s);var i=a(1),e=Object(i.a)({},(function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[i("h1",{attrs:{id:"抓包与分析"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#抓包与分析"}},[t._v("#")]),t._v(" 抓包与分析")]),t._v(" "),i("h2",{attrs:{id:"前言"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),i("p",[i("strong",[t._v("tcpdump")]),t._v(" 和 "),i("strong",[t._v("Wireshark")]),t._v(" 是最常用的网络抓包和分析工具，更是分析网络性能必不可少的利器。它们能把我们「看不见」的数据包，呈现在我们眼前，一目了然。")]),t._v(" "),i("ul",[i("li",[t._v("tcpdump 仅支持命令行格式使用，常用在 Linux 服务器中抓取和分析网络包。")]),t._v(" "),i("li",[t._v("Wireshark 除了可以抓包外，还提供了可视化分析网络包的图形页面。")])]),t._v(" "),i("p",[t._v("所以，这两者实际上是搭配使用的，先用 tcpdump 命令在 Linux 服务器上抓包，接着把抓包的文件拖出到 Windows 电脑后，用 Wireshark 可视化分析。")]),t._v(" "),i("p",[t._v("当然，如果你是在 Windows 上抓包，只需要用 Wireshark 工具就可以。")]),t._v(" "),i("h2",{attrs:{id:"使用-tcpdump-抓包"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#使用-tcpdump-抓包"}},[t._v("#")]),t._v(" 使用 tcpdump 抓包")]),t._v(" "),i("p",[t._v("tcpdump 提供了大量的选项以及各式各样的过滤表达式，来帮助我们抓取指定的数据包。不过只需要掌握一些常用选项和过滤表达式，就可以满足大部分场景的需要了。")]),t._v(" "),i("h3",{attrs:{id:"抓取-ping-包"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#抓取-ping-包"}},[t._v("#")]),t._v(" 抓取 ping 包")]),t._v(" "),i("p",[t._v("假设我们要抓取下面的 ping 的数据包：")]),t._v(" "),i("div",{staticStyle:{"text-align":"center"}},[i("img",{staticStyle:{width:"740px"},attrs:{src:a(495),alt:"ping 数据包"}}),t._v(" "),i("p",{staticStyle:{"text-align":"center",color:"#888"}},[t._v("（ping 数据包）")])]),t._v(" "),i("p",[t._v("要抓取上面的 ping 命令数据包，首先我们要知道 ping 的数据包是 "),i("code",[t._v("icmp")]),t._v(" 协议，接着在使用 tcpdump 抓包的时候，就可以指定只抓 icmp 协议的数据包：")]),t._v(" "),i("div",{staticClass:"language-bash line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-bash"}},[i("code",[i("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -i eth0 表示抓取 eth0 网口的数据包")]),t._v("\n"),i("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# icmp    表示抓取 icmp 协议的数据包")]),t._v("\n"),i("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# host    表示主机过滤，抓取对应 IP 的数据包")]),t._v("\n"),i("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# -nn     表示不解析 IP 地址和端口号的名称")]),t._v("\ntcpdump -i eth0 icmp and "),i("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" "),i("span",{pre:!0,attrs:{class:"token number"}},[t._v("112.80")]),t._v(".248.76 -nn\n")])]),t._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[t._v("1")]),i("br"),i("span",{staticClass:"line-number"},[t._v("2")]),i("br"),i("span",{staticClass:"line-number"},[t._v("3")]),i("br"),i("span",{staticClass:"line-number"},[t._v("4")]),i("br"),i("span",{staticClass:"line-number"},[t._v("5")]),i("br")])]),i("p",[t._v("当 tcpdump 抓取到 icmp 数据包后，输出内容如下：")]),t._v(" "),i("div",{staticStyle:{"text-align":"center"}},[i("img",{staticStyle:{width:"740px"},attrs:{src:a(496),alt:"抓取 ping 的数据包"}}),t._v(" "),i("p",{staticStyle:{"text-align":"center",color:"#888"}},[t._v("（抓取 ping 的数据包）")])]),t._v(" "),i("p",[t._v("数据的格式是："),i("code",[t._v("时间戳 协议 源地址.源端口 > 目的地址.目的端口 网络包详细信息")])]),t._v(" "),i("p",[t._v("从 tcpdump 抓取的 icmp 数据包，我们很清楚的看到 "),i("code",[t._v("icmp echo")]),t._v(" 的交互过程了，首先发送方发起了 "),i("code",[t._v("ICMP echo request")]),t._v(" 请求报文，接收方收到后回了一个 "),i("code",[t._v("ICMP echo reply")]),t._v(" 响应报文，之后 "),i("code",[t._v("seq")]),t._v(" 是递增的。")]),t._v(" "),i("h3",{attrs:{id:"常见用法整理"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#常见用法整理"}},[t._v("#")]),t._v(" 常见用法整理")]),t._v(" "),i("p",[t._v("这里总结一下 tcpdump 最常见的用法。")]),t._v(" "),i("p",[t._v("首先是常用的选项，如下表所示：")]),t._v(" "),i("p",[i("svg",{attrs:{id:"SvgjsSvg1006",width:"738",height:"339",xmlns:"http://www.w3.org/2000/svg",version:"1.1","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:svgjs":"http://svgjs.com/svgjs"}},[i("defs",{attrs:{id:"SvgjsDefs1007"}}),i("g",{attrs:{id:"SvgjsG1008",transform:"translate(25,25)"}},[i("path",{attrs:{id:"SvgjsPath1009",d:"M0 0L688 0L688 48 L0 48Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#cce5ff"}}),i("g",{attrs:{id:"SvgjsG1010"}},[i("text",{attrs:{id:"SvgjsText1011","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"688px",fill:"#323232","font-weight":"700",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"700","font-style":"",opacity:"1",y:"10",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1012",dy:"20",x:"344"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1013"}},[t._v("tcpdump 使用 —— 选项")])])])])]),i("g",{attrs:{id:"SvgjsG1014",transform:"translate(25,73)"}},[i("path",{attrs:{id:"SvgjsPath1015",d:"M0 0L103.26880000000001 0L103.26880000000001 46 L0 46Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#cce5ff"}}),i("path",{attrs:{id:"SvgjsPath1016",d:"M103.26880000000001 0L362.6448 0L362.6448 46 L103.26880000000001 46Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#cce5ff"}}),i("path",{attrs:{id:"SvgjsPath1017",d:"M362.64480000000003 0L688 0L688 46 L362.64480000000003 46Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#cce5ff"}}),i("g",{attrs:{id:"SvgjsG1018"}},[i("text",{attrs:{id:"SvgjsText1019","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"104px",fill:"#323232","font-weight":"700",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"700","font-style":"",opacity:"1",y:"9",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1020",dy:"20",x:"52"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1021"}},[t._v("选项")])])])]),i("g",{attrs:{id:"SvgjsG1022"}},[i("text",{attrs:{id:"SvgjsText1023","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"260px",fill:"#323232","font-weight":"700",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"700","font-style":"",opacity:"1",y:"9",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1024",dy:"20",x:"233.2688"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1025"}},[t._v("示例")])])])]),i("g",{attrs:{id:"SvgjsG1026"}},[i("text",{attrs:{id:"SvgjsText1027","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"326px",fill:"#323232","font-weight":"700",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"700","font-style":"",opacity:"1",y:"9",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1028",dy:"20",x:"525.6448"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1029"}},[t._v("说明")])])])])]),i("g",{attrs:{id:"SvgjsG1030",transform:"translate(25,118)"}},[i("path",{attrs:{id:"SvgjsPath1031",d:"M0 0L103.26880000000001 0L103.26880000000001 49 L0 49Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1032",d:"M103.26880000000001 0L362.6448 0L362.6448 49 L103.26880000000001 49Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1033",d:"M362.64480000000003 0L688 0L688 49 L362.64480000000003 49Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1034",d:"M0 49L103.26880000000001 49L103.26880000000001 98 L0 98Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1035",d:"M103.26880000000001 49L362.6448 49L362.6448 98 L103.26880000000001 98Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1036",d:"M362.64480000000003 49L688 49L688 98 L362.64480000000003 98Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1037",d:"M0 98L103.26880000000001 98L103.26880000000001 147 L0 147Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1038",d:"M103.26880000000001 98L362.6448 98L362.6448 147 L103.26880000000001 147Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1039",d:"M362.64480000000003 98L688 98L688 147 L362.64480000000003 147Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1040",d:"M0 147L103.26880000000001 147L103.26880000000001 196 L0 196Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1041",d:"M103.26880000000001 147L362.6448 147L362.6448 196 L103.26880000000001 196Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1042",d:"M362.64480000000003 147L688 147L688 196 L362.64480000000003 196Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("g",{attrs:{id:"SvgjsG1043"}},[i("text",{attrs:{id:"SvgjsText1044","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"104px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"6.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1045",dy:"24",x:"52"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1046"}},[t._v("-i")])])])]),i("g",{attrs:{id:"SvgjsG1047"}},[i("text",{attrs:{id:"SvgjsText1048","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"260px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"6.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1049",dy:"24",x:"233.2688"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1050"}},[t._v("tcpdump -i eth0")])])])]),i("g",{attrs:{id:"SvgjsG1051"}},[i("text",{attrs:{id:"SvgjsText1052","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"326px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"-5.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1053",dy:"24",x:"525.6448"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1054"}},[t._v("指定网络接口，默认是 0 号接口")])]),i("tspan",{attrs:{id:"SvgjsTspan1055",dy:"24",x:"525.6448"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1056"}},[t._v("（如 eth0），any 表示所有接口")])])])]),i("g",{attrs:{id:"SvgjsG1057"}},[i("text",{attrs:{id:"SvgjsText1058","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"104px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"55.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1059",dy:"24",x:"52"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1060"}},[t._v("-nn")])])])]),i("g",{attrs:{id:"SvgjsG1061"}},[i("text",{attrs:{id:"SvgjsText1062","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"260px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"55.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1063",dy:"24",x:"233.2688"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1064"}},[t._v("tcpdump -nn")])])])]),i("g",{attrs:{id:"SvgjsG1065"}},[i("text",{attrs:{id:"SvgjsText1066","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"326px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"55.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1067",dy:"24",x:"525.6448"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1068"}},[t._v("不解析 IP 地址和端口号的名称")])])])]),i("g",{attrs:{id:"SvgjsG1069"}},[i("text",{attrs:{id:"SvgjsText1070","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"104px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"104.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1071",dy:"24",x:"52"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1072"}},[t._v("-c")])])])]),i("g",{attrs:{id:"SvgjsG1073"}},[i("text",{attrs:{id:"SvgjsText1074","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"260px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"104.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1075",dy:"24",x:"233.2688"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1076"}},[t._v("tcpdump -c 5")])])])]),i("g",{attrs:{id:"SvgjsG1077"}},[i("text",{attrs:{id:"SvgjsText1078","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"326px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"104.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1079",dy:"24",x:"525.6448"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1080"}},[t._v("限制要抓取的网络包的个数")])])])]),i("g",{attrs:{id:"SvgjsG1081"}},[i("text",{attrs:{id:"SvgjsText1082","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"104px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"153.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1083",dy:"24",x:"52"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1084"}},[t._v("-w")])])])]),i("g",{attrs:{id:"SvgjsG1085"}},[i("text",{attrs:{id:"SvgjsText1086","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"260px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"153.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1087",dy:"24",x:"233.2688"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1088"}},[t._v("tcpdump -w file.pcap")])])])]),i("g",{attrs:{id:"SvgjsG1089"}},[i("text",{attrs:{id:"SvgjsText1090","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"326px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"141.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1091",dy:"24",x:"525.6448"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1092"}},[t._v("保存到文件中，文件名通常以")])]),i("tspan",{attrs:{id:"SvgjsTspan1093",dy:"24",x:"525.6448"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1094"}},[t._v(".pcap 为后缀")])])])])])])]),t._v(" "),i("p",[t._v("接下来是常用的过滤表达式，如下表所示：")]),t._v(" "),i("p",[i("svg",{attrs:{id:"SvgjsSvg1112",width:"738",height:"386",xmlns:"http://www.w3.org/2000/svg",version:"1.1","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:svgjs":"http://svgjs.com/svgjs"}},[i("defs",{attrs:{id:"SvgjsDefs1113"}}),i("g",{attrs:{id:"SvgjsG1114",transform:"translate(25,25)"}},[i("path",{attrs:{id:"SvgjsPath1115",d:"M0 0L688 0L688 48 L0 48Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffcc99"}}),i("g",{attrs:{id:"SvgjsG1116"}},[i("text",{attrs:{id:"SvgjsText1117","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"688px",fill:"#323232","font-weight":"700",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"700","font-style":"",opacity:"1",y:"10",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1118",dy:"20",x:"344"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1119"}},[t._v("tcpdump 使用 —— 过滤表达式")])])])])]),i("g",{attrs:{id:"SvgjsG1120",transform:"translate(25,73)"}},[i("path",{attrs:{id:"SvgjsPath1121",d:"M0 0L220.2976 0L220.2976 46 L0 46Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffcc99"}}),i("path",{attrs:{id:"SvgjsPath1122",d:"M220.2976 0L516.688 0L516.688 46 L220.2976 46Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffcc99"}}),i("path",{attrs:{id:"SvgjsPath1123",d:"M516.688 0L688 0L688 46 L516.688 46Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffcc99"}}),i("g",{attrs:{id:"SvgjsG1124"}},[i("text",{attrs:{id:"SvgjsText1125","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"221px",fill:"#323232","font-weight":"700",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"700","font-style":"",opacity:"1",y:"9",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1126",dy:"20",x:"110.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1127"}},[t._v("选项")])])])]),i("g",{attrs:{id:"SvgjsG1128"}},[i("text",{attrs:{id:"SvgjsText1129","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"297px",fill:"#323232","font-weight":"700",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"700","font-style":"",opacity:"1",y:"9",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1130",dy:"20",x:"368.7976"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1131"}},[t._v("示例")])])])]),i("g",{attrs:{id:"SvgjsG1132"}},[i("text",{attrs:{id:"SvgjsText1133","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"172px",fill:"#323232","font-weight":"700",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"700","font-style":"",opacity:"1",y:"9",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1134",dy:"20",x:"602.688"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1135"}},[t._v("说明")])])])])]),i("g",{attrs:{id:"SvgjsG1136",transform:"translate(25,118)"}},[i("path",{attrs:{id:"SvgjsPath1137",d:"M0 0L220.2288 0L220.2288 48.6 L0 48.6Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1138",d:"M220.2288 0L517.6512 0L517.6512 48.6 L220.2288 48.6Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1139",d:"M517.6512 0L688 0L688 48.6 L517.6512 48.6Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1140",d:"M0 48.6L220.2288 48.6L220.2288 97.2 L0 97.2Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1141",d:"M220.2288 48.6L517.6512 48.6L517.6512 97.2 L220.2288 97.2Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1142",d:"M517.6512 48.6L688 48.6L688 97.2 L517.6512 97.2Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1143",d:"M0 97.2L220.2288 97.2L220.2288 145.8 L0 145.8Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1144",d:"M220.2288 97.2L517.6512 97.2L517.6512 145.8 L220.2288 145.8Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1145",d:"M517.6512 97.2L688 97.2L688 145.8 L517.6512 145.8Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1146",d:"M0 145.79999999999998L220.2288 145.79999999999998L220.2288 194.39999999999998 L0 194.39999999999998Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1147",d:"M220.2288 145.79999999999998L517.6512 145.79999999999998L517.6512 194.39999999999998 L220.2288 194.39999999999998Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1148",d:"M517.6512 145.79999999999998L688 145.79999999999998L688 194.39999999999998 L517.6512 194.39999999999998Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1149",d:"M0 194.4L220.2288 194.4L220.2288 243 L0 243Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1150",d:"M220.2288 194.4L517.6512 194.4L517.6512 243 L220.2288 243Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("path",{attrs:{id:"SvgjsPath1151",d:"M517.6512 194.4L688 194.4L688 243 L517.6512 243Z",stroke:"rgba(205,206,199,1)","stroke-width":"1","fill-opacity":"1",fill:"#faf7ed"}}),i("g",{attrs:{id:"SvgjsG1152"}},[i("text",{attrs:{id:"SvgjsText1153","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"221px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"6.300000000000001",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1154",dy:"24",x:"110.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1155"}},[t._v("host、src host、dst host")])])])]),i("g",{attrs:{id:"SvgjsG1156"}},[i("text",{attrs:{id:"SvgjsText1157","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"298px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"6.300000000000001",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1158",dy:"24",x:"369.2288"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1159"}},[t._v("tcpdump -nn host 192.168.1.100")])])])]),i("g",{attrs:{id:"SvgjsG1160"}},[i("text",{attrs:{id:"SvgjsText1161","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"171px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"6.300000000000001",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1162",dy:"24",x:"603.1512"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1163"}},[t._v("主机过滤")])])])]),i("g",{attrs:{id:"SvgjsG1164"}},[i("text",{attrs:{id:"SvgjsText1165","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"221px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"54.900000000000006",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1166",dy:"24",x:"110.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1167"}},[t._v("port、src port、dst port")])])])]),i("g",{attrs:{id:"SvgjsG1168"}},[i("text",{attrs:{id:"SvgjsText1169","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"298px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"54.900000000000006",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1170",dy:"24",x:"369.2288"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1171"}},[t._v("tcpdump -nn port 80")])])])]),i("g",{attrs:{id:"SvgjsG1172"}},[i("text",{attrs:{id:"SvgjsText1173","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"171px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"54.900000000000006",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1174",dy:"24",x:"603.1512"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1175"}},[t._v("端口过滤")])])])]),i("g",{attrs:{id:"SvgjsG1176"}},[i("text",{attrs:{id:"SvgjsText1177","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"221px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"91.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1178",dy:"24",x:"110.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1179"}},[t._v("ip、ip6、arp、tcp、udp、")])]),i("tspan",{attrs:{id:"SvgjsTspan1180",dy:"24",x:"110.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1181"}},[t._v("icmp")])])])]),i("g",{attrs:{id:"SvgjsG1182"}},[i("text",{attrs:{id:"SvgjsText1183","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"298px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"103.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1184",dy:"24",x:"369.2288"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1185"}},[t._v("tcpdump -nn tcp")])])])]),i("g",{attrs:{id:"SvgjsG1186"}},[i("text",{attrs:{id:"SvgjsText1187","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"171px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"103.5",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1188",dy:"24",x:"603.1512"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1189"}},[t._v("协议过滤")])])])]),i("g",{attrs:{id:"SvgjsG1190"}},[i("text",{attrs:{id:"SvgjsText1191","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"221px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"152.1",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1192",dy:"24",x:"110.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1193"}},[t._v("and、or、not")])])])]),i("g",{attrs:{id:"SvgjsG1194"}},[i("text",{attrs:{id:"SvgjsText1195","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"298px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"140.1",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1196",dy:"24",x:"369.2288"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1197"}},[t._v("tcpdump -nn host")])]),i("tspan",{attrs:{id:"SvgjsTspan1198",dy:"24",x:"369.2288"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1199"}},[t._v("192.168.1.100 and port 80")])])])]),i("g",{attrs:{id:"SvgjsG1200"}},[i("text",{attrs:{id:"SvgjsText1201","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"171px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"152.1",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1202",dy:"24",x:"603.1512"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1203"}},[t._v("逻辑表达式")])])])]),i("g",{attrs:{id:"SvgjsG1204"}},[i("text",{attrs:{id:"SvgjsText1205","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"221px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"200.7",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1206",dy:"24",x:"110.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1207"}},[t._v("tcp[tcpflags]")])])])]),i("g",{attrs:{id:"SvgjsG1208"}},[i("text",{attrs:{id:"SvgjsText1209","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"298px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"188.7",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1210",dy:"24",x:"369.2288"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1211"}},[t._v('tcpdump -nn "tcp[tcpflags] &')])]),i("tspan",{attrs:{id:"SvgjsTspan1212",dy:"24",x:"369.2288"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1213"}},[t._v('tcp-syn != 0"')])])])]),i("g",{attrs:{id:"SvgjsG1214"}},[i("text",{attrs:{id:"SvgjsText1215","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"171px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"150%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"200.7",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1216",dy:"24",x:"603.1512"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1217"}},[t._v("特定状态的 TCP 包")])])])])])])]),t._v(" "),i("p",[t._v("虽然 tcpdump 功能强大，但是输出的格式并不直观。所以在工作中 tcpdump 只是用来抓取数据包，不用来分析数据包，而是把 tcpdump 抓取的数据包保存成 pcap 后缀的文件，接着用 Wireshark 工具进行数据包分析。")]),t._v(" "),i("h2",{attrs:{id:"使用-wireshark-分析包"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#使用-wireshark-分析包"}},[t._v("#")]),t._v(" 使用 Wireshark 分析包")]),t._v(" "),i("p",[t._v("Wireshark 除了可以抓包外，还提供了可视化分析网络包的图形页面，同时，还内置了一系列的汇总分析工具。")]),t._v(" "),i("h3",{attrs:{id:"分析-ping-包"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#分析-ping-包"}},[t._v("#")]),t._v(" 分析 ping 包")]),t._v(" "),i("p",[t._v("比如，拿上面的 ping 例子来说，我们可以使用下面的命令，把抓取的数据包保存到 ping.pcap 文件。")]),t._v(" "),i("div",{staticClass:"language-bash line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-bash"}},[i("code",[i("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 先开一个 shell 窗口")]),t._v("\ntcpdump -i eth0 icmp and "),i("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" "),i("span",{pre:!0,attrs:{class:"token number"}},[t._v("112.80")]),t._v(".248.76 -w ping.pcap\n\n"),i("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 再开一个 shell 窗口")]),t._v("\n"),i("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" -I eth0 -c "),i("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),i("span",{pre:!0,attrs:{class:"token number"}},[t._v("112.80")]),t._v(".248.76\n")])]),t._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[t._v("1")]),i("br"),i("span",{staticClass:"line-number"},[t._v("2")]),i("br"),i("span",{staticClass:"line-number"},[t._v("3")]),i("br"),i("span",{staticClass:"line-number"},[t._v("4")]),i("br"),i("span",{staticClass:"line-number"},[t._v("5")]),i("br")])]),i("p",[t._v("接着把 ping.pcap 文件拖到电脑，再用 Wireshark 打开它。打开后，就可以看到下面这个界面：")]),t._v(" "),i("div",{staticStyle:{"text-align":"center",width:"860px"}},[i("img",{attrs:{src:a(497),alt:"ping.pcap"}}),t._v(" "),i("p",{staticStyle:{"text-align":"center",color:"#888"}},[t._v("（ping.pcap）")])]),t._v(" "),i("p",[t._v("如上，在 Wireshark 的页面里，可以更加直观的分析数据包，不仅展示各个网络包的头部信息，还会用不同的颜色来区分不同的协议，由于这次抓包只有 ICMP 协议，所以只有紫色的条目。")]),t._v(" "),i("p",[t._v("接着，在网络包列表中选择某一个网络包后，在其下面的网络包详情中，"),i("strong",[t._v("可以更清楚的看到，这个网络包在协议栈各层的详细信息")]),t._v("。比如，以编号 1 的网络包为例子：")]),t._v(" "),i("div",{staticStyle:{"text-align":"center",width:"860px"}},[i("img",{attrs:{src:a(498),alt:"编号 1 的网络包"}}),t._v(" "),i("p",{staticStyle:{"text-align":"center",color:"#888"}},[t._v("（编号 1 的网络包）")])]),t._v(" "),i("p",[t._v("Wireshark 用了分层的方式，展示了各个层的包头信息：")]),t._v(" "),i("ul",[i("li",[t._v("可以在数据链路层，看到 MAC 包头信息，如源 MAC 地址和目标 MAC 地址等字段。")]),t._v(" "),i("li",[t._v("可以在 IP 层，看到 IP 包头信息，如源 IP 地址和目标 IP 地址、TTL、IP 包长度、协议等 IP 协议各个字段的数值和含义。")]),t._v(" "),i("li",[t._v("可以在 ICMP 层，看到 ICMP 包头信息，比如 Type、Code 等 ICMP 协议各个字段的数值和含义。")])]),t._v(" "),i("p",[t._v("从 ping 的例子中，我们可以看到网络分层就像有序的分工，每一层都有自己的责任范围和信息，上层协议完成工作后就交给下一层，最终形成一个完整的网络包。")]),t._v(" "),i("div",{staticStyle:{"text-align":"center",width:"860px"}},[i("svg",{attrs:{id:"SvgjsSvg1007",width:"566",height:"315",xmlns:"http://www.w3.org/2000/svg",version:"1.1","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:svgjs":"http://svgjs.com/svgjs"}},[i("defs",{attrs:{id:"SvgjsDefs1007"}}),i("g",{attrs:{id:"SvgjsG1008",transform:"translate(396.9375,25)"}},[i("path",{attrs:{id:"SvgjsPath1009",d:"M 9.920625000000001 0L 20.141875000000002 0L 20.141875000000002 249.96875L 30.0625 249.96875L 15.03125 265L 0 249.96875L 9.920625000000001 249.96875L 9.920625000000001 0Z",stroke:"none","fill-opacity":"1",fill:"#ffcc99"}}),i("g",{attrs:{id:"SvgjsG1010"}},[i("text",{attrs:{id:"SvgjsText1011","font-family":"微软雅黑","text-anchor":"middle","font-size":"13px",width:"43px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"13px",weight:"400","font-style":"",opacity:"1",y:"108.625",transform:"rotate(0)"}})])]),i("g",{attrs:{id:"SvgjsG1012",transform:"translate(231,36)"}},[i("path",{attrs:{id:"SvgjsPath1013",d:"M 0 0L 139 0L 139 50L 0 50Z",stroke:"rgba(149,116,162,1)","stroke-width":"2","fill-opacity":"1",fill:"#e1d6e5"}}),i("g",{attrs:{id:"SvgjsG1014"}},[i("text",{attrs:{id:"SvgjsText1015","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"119px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"11",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1016",dy:"20",x:"69.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1017"}},[t._v("ICMP 头 + Data")])])])])]),i("g",{attrs:{id:"SvgjsG1018",transform:"translate(231,122)"}},[i("path",{attrs:{id:"SvgjsPath1019",d:"M 0 0L 139 0L 139 50L 0 50Z",stroke:"rgba(149,116,162,1)","stroke-width":"2","fill-opacity":"1",fill:"#e1d6e5"}}),i("g",{attrs:{id:"SvgjsG1020"}},[i("text",{attrs:{id:"SvgjsText1021","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"119px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"11",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1022",dy:"20",x:"69.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1023"}},[t._v("ICMP 头 + Data")])])])])]),i("g",{attrs:{id:"SvgjsG1024",transform:"translate(231,208)"}},[i("path",{attrs:{id:"SvgjsPath1025",d:"M 0 0L 139 0L 139 50L 0 50Z",stroke:"rgba(149,116,162,1)","stroke-width":"2","fill-opacity":"1",fill:"#e1d6e5"}}),i("g",{attrs:{id:"SvgjsG1026"}},[i("text",{attrs:{id:"SvgjsText1027","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"119px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"11",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1028",dy:"20",x:"69.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1029"}},[t._v("ICMP 头 + Data")])])])])]),i("g",{attrs:{id:"SvgjsG1030",transform:"translate(128,122)"}},[i("path",{attrs:{id:"SvgjsPath1031",d:"M 0 0L 103 0L 103 50L 0 50Z",stroke:"rgba(213,182,90,1)","stroke-width":"2","fill-opacity":"1",fill:"#fff2cc"}}),i("g",{attrs:{id:"SvgjsG1032"}},[i("text",{attrs:{id:"SvgjsText1033","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"83px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"11",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1034",dy:"20",x:"51.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1035"}},[t._v("IP 头")])])])])]),i("g",{attrs:{id:"SvgjsG1036",transform:"translate(128,208)"}},[i("path",{attrs:{id:"SvgjsPath1037",d:"M 0 0L 103 0L 103 50L 0 50Z",stroke:"rgba(213,182,90,1)","stroke-width":"2","fill-opacity":"1",fill:"#fff2cc"}}),i("g",{attrs:{id:"SvgjsG1038"}},[i("text",{attrs:{id:"SvgjsText1039","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"83px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"11",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1040",dy:"20",x:"51.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1041"}},[t._v("IP 头")])])])])]),i("g",{attrs:{id:"SvgjsG1042",transform:"translate(25,208)"}},[i("path",{attrs:{id:"SvgjsPath1043",d:"M 0 0L 103 0L 103 50L 0 50Z",stroke:"rgba(115,141,177,1)","stroke-width":"2","fill-opacity":"1",fill:"#dbe8fd"}}),i("g",{attrs:{id:"SvgjsG1044"}},[i("text",{attrs:{id:"SvgjsText1045","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"83px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"11",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1046",dy:"20",x:"51.5"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1047"}},[t._v("以太帧头")])])])])]),i("g",{attrs:{id:"SvgjsG1048",transform:"translate(417,36)"}},[i("path",{attrs:{id:"SvgjsPath1049",d:"M 0 0L 120 0L 120 40L 0 40Z",stroke:"none",fill:"none"}}),i("g",{attrs:{id:"SvgjsG1050"}},[i("text",{attrs:{id:"SvgjsText1051","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"120px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"6",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1052",dy:"20",x:"60"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1053"}},[t._v("ICMP 协议")])])])])]),i("g",{attrs:{id:"SvgjsG1054",transform:"translate(397,127)"}},[i("path",{attrs:{id:"SvgjsPath1055",d:"M 0 0L 120 0L 120 40L 0 40Z",stroke:"none",fill:"none"}}),i("g",{attrs:{id:"SvgjsG1056"}},[i("text",{attrs:{id:"SvgjsText1057","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"120px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"6",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1058",dy:"20",x:"60"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1059"}},[t._v("IP 层")])])])])]),i("g",{attrs:{id:"SvgjsG1060",transform:"translate(421,213)"}},[i("path",{attrs:{id:"SvgjsPath1061",d:"M 0 0L 120 0L 120 40L 0 40Z",stroke:"none",fill:"none"}}),i("g",{attrs:{id:"SvgjsG1062"}},[i("text",{attrs:{id:"SvgjsText1063","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"120px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"6",transform:"rotate(0)"}},[i("tspan",{attrs:{id:"SvgjsTspan1064",dy:"20",x:"60"}},[i("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1065"}},[t._v("数据链路层")])])])])])]),t._v(" "),i("p",{staticStyle:{"text-align":"center",color:"#888"}},[t._v("（ping 网络包组装过程）")])]),t._v(" "),i("p",[t._v("接下来通过 tcpdump 和 Wireshark 这两大网络分析利器，抓取和分析 HTTP 协议网络包，并理解 TCP 三次握手和四次挥手的工作原理。")]),t._v(" "),i("h3",{attrs:{id:"分析-tcp-三次握手和四次挥手"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#分析-tcp-三次握手和四次挥手"}},[t._v("#")]),t._v(" 分析 TCP 三次握手和四次挥手")]),t._v(" "),i("p",[t._v("以访问 112.80.248.76 为例：")]),t._v(" "),i("div",{staticClass:"language-bash line-numbers-mode"},[i("pre",{pre:!0,attrs:{class:"language-bash"}},[i("code",[i("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 首先打开一个 shell 窗口，用 tcpdump 命令抓取数据包")]),t._v("\ntcpdump -i any tcp and "),i("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v(" "),i("span",{pre:!0,attrs:{class:"token number"}},[t._v("112.80")]),t._v(".248.76 and port "),i("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" -w http.pcap\n\n"),i("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接着再打开一个 shell 窗口，执行下面的 curl 命令")]),t._v("\n"),i("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" http://112.80.248.76\n")])]),t._v(" "),i("div",{staticClass:"line-numbers-wrapper"},[i("span",{staticClass:"line-number"},[t._v("1")]),i("br"),i("span",{staticClass:"line-number"},[t._v("2")]),i("br"),i("span",{staticClass:"line-number"},[t._v("3")]),i("br"),i("span",{staticClass:"line-number"},[t._v("4")]),i("br"),i("span",{staticClass:"line-number"},[t._v("5")]),i("br")])]),i("p",[t._v("最后，回到第一个 shell 窗口，按下 Ctrl+C 停止 tcpdump，并把得到的 http.pcap 取出到电脑。")]),t._v(" "),i("p",[t._v("使用 Wireshark 打开 http.pcap 后，你就可以在 Wireshark 中，看到如下的界面：")]),t._v(" "),i("div",{staticStyle:{"text-align":"center",width:"860px"}},[i("img",{attrs:{src:a(499),alt:"http.pcap"}}),t._v(" "),i("p",{staticStyle:{"text-align":"center",color:"#888"}},[t._v("（http.pcap）")])]),t._v(" "),i("p",[t._v("我们都知道 HTTP 是基于 TCP 协议进行传输的，那么：")]),t._v(" "),i("ul",[i("li",[t._v("最开始的 3 个包就是 TCP 三次握手建立连接的包")]),t._v(" "),i("li",[t._v("中间是 HTTP 请求和响应的包")]),t._v(" "),i("li",[t._v("而最后的 3 个包则是 TCP 断开连接的挥手包")])]),t._v(" "),i("p",[t._v("Wireshark 可以用时序图的方式显示数据包交互的过程，从菜单栏中，点击「统计 (Statistics)」->「流量图 (Flow Graph)」，然后在弹出的界面中的「流类型」选择「TCP Flows」，就可以更清晰的看到整个过程中 TCP 流的执行过程：")]),t._v(" "),i("div",{staticStyle:{"text-align":"center",width:"860px"}},[i("img",{attrs:{src:a(500),alt:"TCP Flows 时序图"}}),t._v(" "),i("p",{staticStyle:{"text-align":"center",color:"#888"}},[t._v("（TCP Flows 时序图）")])]),t._v(" "),i("p",[t._v("你可能会好奇，为什么三次握手连接过程的 Seq 是 0？说好是随机生成的呢，怎么那么巧是 0 的呢？")]),t._v(" "),i("p",[t._v("实际上是因为 Wireshark 工具帮我们做了优化，它默认显示的是序列号 Seq 是相对值，而不是真实值。")]),t._v(" "),i("p",[t._v("如果你想看到实际的序列号的值，可以右键菜单， 然后找到「协议首选项」，接着找到「Relative Seq」后，把它给取消，操作如下：")]),t._v(" "),i("div",{staticStyle:{"text-align":"center",width:"860px"}},[i("img",{attrs:{src:a(501),alt:"取消 Seq 相对值显示的方式"}}),t._v(" "),i("p",{staticStyle:{"text-align":"center",color:"#888"}},[t._v("（取消 Seq 相对值显示的方式）")])]),t._v(" "),i("p",[t._v("取消后，Seq 显示的就是真实值了：")]),t._v(" "),i("div",{staticStyle:{"text-align":"center",width:"860px"}},[i("img",{attrs:{src:a(502),alt:"Seq 真实值显示的 TCP Flows 时序图"}}),t._v(" "),i("p",{staticStyle:{"text-align":"center",color:"#888"}},[t._v("（Seq 真实值显示的 TCP Flows 时序图）")])]),t._v(" "),i("p",[t._v("可见，客户端和服务端的序列号实际上是不同的，序列号是一个随机值。")]),t._v(" "),i("p",[t._v("再来回顾下 TCP 三次握手和四次挥手，整个流程基本是这样的：")]),t._v(" "),i("div",{staticStyle:{"text-align":"center",width:"860px"}},[i("img",{staticStyle:{width:"680px"},attrs:{src:a(503),alt:"TCP 三次握手和四次挥手"}}),t._v(" "),i("p",{staticStyle:{"text-align":"center",color:"#888"}},[t._v("（TCP 三次握手和四次挥手）")])]),t._v(" "),i("p",[t._v("（完）")])])}),[],!1,null,null,null);s.default=e.exports}}]);