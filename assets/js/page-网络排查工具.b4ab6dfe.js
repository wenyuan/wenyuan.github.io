(window.webpackJsonp=window.webpackJsonp||[]).push([[315],{479:function(s,t,a){s.exports=a.p+"assets/img/f12-remote-address.7f1670dd.png"},480:function(s,t,a){s.exports=a.p+"assets/img/f12-network-time.a748829f.png"},481:function(s,t,a){s.exports=a.p+"assets/img/check-certificate.9b9764c9.png"},482:function(s,t,a){s.exports=a.p+"assets/img/f12-check-tls.10f8c541.png"},483:function(s,t,a){s.exports=a.p+"assets/img/baidu-tls-packet.bc340eea.png"},484:function(s,t,a){s.exports=a.p+"assets/img/network-troubleshooting-tools.008afaff.svg"},852:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"网络排查工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网络排查工具"}},[s._v("#")]),s._v(" 网络排查工具")]),s._v(" "),n("p",[s._v("本文介绍网络各层的排查工具。")]),s._v(" "),n("h2",{attrs:{id:"应用层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用层"}},[s._v("#")]),s._v(" 应用层")]),s._v(" "),n("p",[s._v("作为前端开发者，主要以 HTTP 应用的排查工具为主（其他应用开发者应该会有各种熟悉的排查工具）。")]),s._v(" "),n("p",[s._v("现在主流的浏览器是 Google 的 Chrome，它本身就内置了一个开发者工具。在 Chrome 界面里按下 F12，或者是苹果系统的话，还可以按下组合键 option + command + I，启动开发者工具。借助开发者工具，我们可以非常方便地做很多事。")]),s._v(" "),n("h3",{attrs:{id:"找到有问题的服务端-ip"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#找到有问题的服务端-ip"}},[s._v("#")]),s._v(" 找到有问题的服务端 IP")]),s._v(" "),n("p",[s._v("比如有用户报告死活访问不了你的网站，但是你很清楚这个网站的域名对应了很多 IP 地址，你怎么知道用户连的是哪个 IP 呢？")]),s._v(" "),n("p",[s._v("你可以这样做：让客户启用开发者工具，在「Network」页找到主页对象，在它的「Headers」部分，就能看到「Remote address」，这里的 IP 就是当前连接的 IP，比如下面这样：")]),s._v(" "),n("div",{staticStyle:{"text-align":"center"}},[n("img",{staticStyle:{width:"640px"},attrs:{src:a(479),alt:"通过开发者工具查询 IP 地址"}}),s._v(" "),n("p",{staticStyle:{"text-align":"center",color:"#888"}},[s._v("（通过开发者工具查询 IP 地址）")])]),s._v(" "),n("p",[s._v("不过因为 DNS 解析的关系，你很可能下次重连就不是这个 IP 了，所以每次都应该重新确认一下这个信息。")]),s._v(" "),n("p",[s._v("这个技巧，在排查公网的访问问题的时候特别有用。因为现在流量大一点的网站都已经上了 CDN，那就必然在全国乃至全球各地，有少则数十个、多则数百个 CDN 终端节点，在给访问者提供就近的服务。如果有人说他访问不了某个站点了，那么请他用开发者工具，找到他连的远程 IP，然后你再根据这个信息展开排查工作，会节省很多排查时间。")]),s._v(" "),n("h3",{attrs:{id:"辅助排查网页慢的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#辅助排查网页慢的问题"}},[s._v("#")]),s._v(" 辅助排查网页慢的问题")]),s._v(" "),n("p",[s._v("访问页面感觉很慢，那么可以借助开发者工具的时间统计功能，找到耗时较高的 HTTP 资源对象，再针对性排查。比如访问百度很慢（这里我手动调节了模拟网速为 Slow 3G），那么可以先打开开发者工具，然后访问站点，等全部加载完成后，到「Network」页查看这些 HTTP 对象的加载时间。")]),s._v(" "),n("div",{staticStyle:{"text-align":"center"}},[n("img",{staticStyle:{width:"640px"},attrs:{src:a(480),alt:"通过开发者工具查询资源加载时间"}}),s._v(" "),n("p",{staticStyle:{"text-align":"center",color:"#888"}},[s._v("（通过开发者工具查询资源加载时间）")])]),s._v(" "),n("p",[s._v("不过，这个办法只能排查到是哪个资源对象耗时比较长，但更进一步的排查，比如「为什么这个对象的加载时间比别的对象长」这个问题，开发者工具就难以回答了。关于这个问题，需要用到抓包分析来根本性地排查这类问题。")]),s._v(" "),n("h3",{attrs:{id:"解决失效-cookie-带来的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决失效-cookie-带来的问题"}},[s._v("#")]),s._v(" 解决失效 Cookie 带来的问题")]),s._v(" "),n("p",[s._v("有时候我们的 Cookie 过期了，导致无法正常登录站点，那么可以打开开发者工具，到 Application 页，找到「Storage」->「Cookie」，把对应的条目清除。这样下次你再访问这个站点时，对站点来说，你就是一次新的访问，可以生成一次新的 Cookie 了。")]),s._v(" "),n("p",[s._v("当然，你通过删除浏览器缓存的方式，也是可以做到这一点的。但开发者工具的优点是，可以"),n("strong",[s._v("细粒度")]),s._v("到这个网站级别，而删除缓存的方式，删除的就是所有站点的 Cookie 了。")]),s._v(" "),n("h2",{attrs:{id:"表示层和会话层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#表示层和会话层"}},[s._v("#")]),s._v(" 表示层和会话层")]),s._v(" "),n("p",[s._v("表示层和会话层的协议并不多，TLS 可以归入这两个层级。为了对 TLS 的问题进行排查，可以使用两种工具。")]),s._v(" "),n("p",[n("strong",[s._v("第一种，还是基于浏览器做初步的检查，主要是围绕证书本身做检查")]),s._v("。在浏览器的地址栏那里，有一个按钮，点开后就可以查看 TLS 证书等信息：")]),s._v(" "),n("div",{staticStyle:{"text-align":"center"}},[n("img",{staticStyle:{width:"460px"},attrs:{src:a(481),alt:"通过浏览器检查证书"}}),s._v(" "),n("p",{staticStyle:{"text-align":"center",color:"#888"}},[s._v("（通过浏览器检查证书）")])]),s._v(" "),n("p",[s._v("在上面的菜单中，继续点开「连接是安全的」按钮，进而点击「证书有效」按钮，就能查看证书了。")]),s._v(" "),n("p",[s._v("另外，使用开发者工具的「Security」菜单（如果找不到，就从「More tools 里面打开这个菜单」），还可以查看更为详细的 TLS 信息，包括协议版本、密钥交换算法、证书有效期等等。")]),s._v(" "),n("div",{staticStyle:{"text-align":"center"}},[n("img",{staticStyle:{width:"740px"},attrs:{src:a(482),alt:"通过开发者工具查询 TLS 信息"}}),s._v(" "),n("p",{staticStyle:{"text-align":"center",color:"#888"}},[s._v("（通过开发者工具查询 TLS 信息）")])]),s._v(" "),n("p",[n("strong",[s._v("第二种，关于 TLS 握手、密钥交换、密文传输等方面的排查，还是需要用 tcpdump 和 Wireshark 来做")]),s._v("。在 Wireshark 中，可以更加全面地查看 TLS 细节。")]),s._v(" "),n("p",[s._v("比如，我们可以直接看到 TLS 握手阶段里，双方协商"),n("strong",[s._v("过程中")]),s._v("各自展示的 Cipher suite（密码套件；加密套件；密码组；使用的密码组），而在开发者工具里，我们只能看到协商"),n("strong",[s._v("完成后")]),s._v("的选择。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先开一个 shell 窗口")]),s._v("\ntcpdump -i eth0 tcp and port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" -w baidu.pcap\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 再开一个 shell 窗口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --interface eth0 https://www.baidu.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("div",{staticStyle:{"text-align":"center"}},[n("img",{staticStyle:{width:"740px"},attrs:{src:a(483),alt:"访问百度的 TLS 握手阶段报文"}}),s._v(" "),n("p",{staticStyle:{"text-align":"center",color:"#888"}},[s._v("（访问百度的 TLS 握手阶段报文）")])]),s._v(" "),n("h2",{attrs:{id:"传输层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#传输层"}},[s._v("#")]),s._v(" 传输层")]),s._v(" "),n("p",[s._v("传输层毫无疑问是重中之重，工具也很多。接下来就按排查场景来介绍工具。")]),s._v(" "),n("h3",{attrs:{id:"路径可达性测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#路径可达性测试"}},[s._v("#")]),s._v(" 路径可达性测试")]),s._v(" "),n("p",[s._v("如果要测试 TCP 握手，我们可以使用 "),n("strong",[s._v("telnet")]),s._v("、"),n("strong",[s._v("nc")]),s._v(" 这两个常规工具。")]),s._v(" "),n("p",[s._v("使用 telnet：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# telnet www.baidu.com 443")]),s._v("\nTrying "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("112.80")]),s._v(".248.76"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nConnected to www.baidu.com.\nEscape character is "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^]'")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("小贴士")]),s._v(" "),n("p",[s._v("我发现我的那台 CentOS 学习机器没有安装 telnet 命令，可以执行如下命令安装：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum list telnet*           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出 telnet 相关的安装包")]),s._v("\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" telnet-server  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 telnet 服务")]),s._v("\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" telnet.*       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装 telnet 客户端")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])])]),s._v(" "),n("p",[s._v("使用 nc：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nc -w 2 -zv www.baidu.com 443")]),s._v("\nNcat: Version "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.50")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" https://nmap.org/ncat "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nNcat: Connected to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("180.101")]),s._v(".49.11:443.\nNcat: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes sent, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes received "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v(" seconds.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("小贴士")]),s._v(" "),n("p",[s._v("同样，我的那台 CentOS 学习机器也没有安装 nc 命令，可以执行如下命令安装：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("常用参数：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("-l")]),s._v("：用于指定 nc 将处于侦听模式。指定该参数，则意味着 nc 被当作 server，侦听并接受连接，而非向其它地址发起连接。")]),s._v(" "),n("li",[n("code",[s._v("-p <port>")]),s._v("：暂未用到（老版本的 nc 可能需要在端口号前加 -p 参数，当前测试环境未用到这个参数）。")]),s._v(" "),n("li",[n("code",[s._v("-s")]),s._v("：指定发送数据的源 IP 地址，适用于多网卡机。")]),s._v(" "),n("li",[n("code",[s._v("-u")]),s._v("：指定 nc 使用 UDP 协议，默认为 TCP。")]),s._v(" "),n("li",[n("code",[s._v("-v")]),s._v("：输出交互或出错信息，新手调试时尤为有用。")]),s._v(" "),n("li",[n("code",[s._v("-w")]),s._v("：超时秒数，后面跟数字。")]),s._v(" "),n("li",[n("code",[s._v("-z")]),s._v("：表示 zero，表示扫描时不发送任何数据。")])])]),s._v(" "),n("h3",{attrs:{id:"查看当前连接状况"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看当前连接状况"}},[s._v("#")]),s._v(" 查看当前连接状况")]),s._v(" "),n("p",[n("strong",[s._v("netstat")]),s._v(" 命令是一个经典命令了，很多时候都会使用它来获取当前的 TCP、UDP 等的连接信息，比如显示 TCP 传输协议的连线状况：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -ant")]),s._v("\nActive Internet connections "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("servers and established"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:22              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN     \ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:25            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN     \ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3306            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN     \ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN     \ntcp        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".16.7:56676         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".0.55:5574       ESTABLISHED\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"查看当前连接的传输速率"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看当前连接的传输速率"}},[s._v("#")]),s._v(" 查看当前连接的传输速率")]),s._v(" "),n("p",[s._v("有时候，你的网络跑得挺繁忙的，但你却不知道哪个连接占用了大量的带宽？")]),s._v(" "),n("p",[s._v("这时候可以用 "),n("strong",[s._v("iftop")]),s._v("。这个工具不是系统默认自带的，需要安装一下，然后用 sudo 权限执行 "),n("code",[s._v("iftop")]),s._v("，就能看到不同连接的传输速率了。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iftop 安装命令")]),s._v("\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" iftop\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"查看丢包和乱序等的统计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看丢包和乱序等的统计"}},[s._v("#")]),s._v(" 查看丢包和乱序等的统计")]),s._v(" "),n("p",[s._v("用 "),n("strong",[s._v("netstat")]),s._v(" 除了可以获取实时连接状况，还可以获取历史统计信息。比如，你怀疑一台机器的网络很不稳定，除了用 ping 做简单的测试，你还可以用 "),n("code",[s._v("netstat -s")]),s._v(" 来获取更加详细的统计信息。")]),s._v(" "),n("p",[s._v("比如，其中的 TCP 丢包和乱序计数值，就能帮助你判断传输层的状况。")]),s._v(" "),n("p",[s._v("不过单纯使用 netstat -s 命令的输出是一系列静态值，如果想知道当前情况，可以执行下面的命令：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" --diff "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("这个命令会把发生变化的数值进行高亮，方便我们查看。")]),s._v(" "),n("h3",{attrs:{id:"ss"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ss"}},[s._v("#")]),s._v(" ss")]),s._v(" "),n("p",[n("strong",[s._v("ss")]),s._v(" 命令是 Iproute2 包里的命令，也是 netstat 的「取代者」。它提供了对 socket 的丰富的统计信息。")]),s._v(" "),n("p",[s._v("比如下面这条命令比较常用，可以查看到当前连接的统计信息：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -s")]),s._v("\nTotal: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("203")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kernel "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("277")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nTCP:   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("estab "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", closed "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", orphaned "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", synrecv "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", timewait "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", ports "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\nTransport Total     IP        IPv6\n*\t      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("277")]),s._v("       -         -        \nRAW\t      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        \nUDP\t      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("        \nTCP\t      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("        \nINET\t  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("        \nFRAG\t  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("当然，也不能完全说「ss 等于 netstat」，因为事实上 netstat 命令的功能，被拆分到了 ss 和 ip 这两个命令里，并分别得到了丰富和加强。")]),s._v(" "),n("h2",{attrs:{id:"网络层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网络层"}},[s._v("#")]),s._v(" 网络层")]),s._v(" "),n("p",[s._v("在这一层，除了可以直接用 ping 这个非常简便的工具以外，还有另外两个很重要的命令，它们能提供更为强大的排查能力，它们就是 "),n("strong",[s._v("traceroute")]),s._v(" 和 "),n("strong",[s._v("mtr")]),s._v("。")]),s._v(" "),n("h3",{attrs:{id:"查看网络路径状况"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看网络路径状况"}},[s._v("#")]),s._v(" 查看网络路径状况")]),s._v(" "),n("p",[s._v("下面这个是我在服务器上做的一个简单的 traceroute 的典型输出：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# traceroute www.baidu.com")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("traceroute")]),s._v(" to www.baidu.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("112.80")]),s._v(".248.76"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" hops max, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" byte packets\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  * * *\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  * * *\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  * * *\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("  * * *\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  * "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.162 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.162"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.972")]),s._v(" ms *\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.169 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.169"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.346")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.356")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".196.13 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".196.13"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.968")]),s._v(" ms\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("211.95")]),s._v(".32.89 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("211.95")]),s._v(".32.89"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.964")]),s._v(" ms * "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("211.95")]),s._v(".32.45 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("211.95")]),s._v(".32.45"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.069")]),s._v(" ms\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("219.158")]),s._v(".104.222 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("219.158")]),s._v(".104.222"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.010")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.423")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("219.158")]),s._v(".104.218 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("219.158")]),s._v(".104.218"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.700")]),s._v(" ms\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".228.74 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".228.74"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17.048")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".228.118 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".228.118"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.686")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".228.122 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".228.122"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.342")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.37")]),s._v(".96.130 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.37")]),s._v(".96.130"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.947")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.37")]),s._v(".96.182 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.37")]),s._v(".96.182"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.665")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".226.10 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".226.10"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.293")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  * * *\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  * * *\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  * * *\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("  * * *\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("  * * *\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("  * * *\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("  * * *\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("  * * *\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("  * * *\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("  * * *\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("可以看到有些跳转里面没有 IP，只有星号，相信很多人都会遇到这种情况。其实，你稍微改一下命令，也就是加上 "),n("code",[s._v("-I")]),s._v(" 参数（I 代表 ICMP），就可以正常运行了：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# traceroute www.baidu.com -I")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("traceroute")]),s._v(" to www.baidu.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("112.80")]),s._v(".248.76"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" hops max, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" byte packets\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  * * *\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.73")]),s._v(".56.220 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.73")]),s._v(".56.220"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.296")]),s._v(" ms * *\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  * * *\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("  * * *\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.170 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.170"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.791")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.162 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.162"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.963")]),s._v(" ms "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.170 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.170"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.798")]),s._v(" ms\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.169 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.169"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.736")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.529")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.930")]),s._v(" ms\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("  * * *\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("219.158")]),s._v(".11.2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("219.158")]),s._v(".11.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.789")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.776")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.761")]),s._v(" ms\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".228.74 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".228.74"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.551")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.332")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.390")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".226.18 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".226.18"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.614")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.621")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.615")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("182.61")]),s._v(".216.0 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("182.61")]),s._v(".216.0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13.174")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.333")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.377")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  * * *\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("112.80")]),s._v(".248.76 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("112.80")]),s._v(".248.76"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.841")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.656")]),s._v(" ms  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.668")]),s._v(" ms\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("背后的原理，就是 traceroute 默认是用 UDP 作为探测协议的，但是很多网络设备并不会对 UDP 作出回应。所以我们改成 ICMP 协议做探测后，网络设备就有回应了。其实，Windows 上的 tracert，就是默认用 ICMP，这一点跟 Linux 正好是反过来的。")]),s._v(" "),n("p",[s._v("但是，traceroute 也有一个明显的不足："),n("strong",[s._v("它不能对这个路径做连续多次的探测")]),s._v("。")]),s._v(" "),n("p",[s._v("于是，mtr 出现了，它可以说是 traceroute 的超集，除了 traceroute 的功能，还能实现丰富的探测报告。尤其是它对每一跳的丢包率的百分比，是用来定位路径中节点问题的重要指标。所以，当你在遇到「"),n("strong",[s._v("连接状况时好时坏的问题")]),s._v("」的时候，单纯用一次性的 traceroute 恐怕难以看清楚，那就可以用 mtr，来获取更加全面和动态的链路状态信息了。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mtr www.baidu.com -r -c 10")]),s._v("\nStart: Wed Sep "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":34:26 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\nHOST: study                       Loss%   Snt   Last   Avg  Best  Wrst StDev\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- ???                       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- ???                       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- ???                       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- ???                       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.162            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.6")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.3")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.6")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.9")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.196")]),s._v(".197.161            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.4")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.3")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.9")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- ???                       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("219.158")]),s._v(".107.6              "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("%    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22.1")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24.0")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.8")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32.6")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.9")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("110.242")]),s._v(".66.178            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.0")]),s._v("%    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26.7")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26.6")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26.5")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26.7")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("."),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("-- ???                       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("h3",{attrs:{id:"查看路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看路由"}},[s._v("#")]),s._v(" 查看路由")]),s._v(" "),n("p",[s._v("命令 "),n("strong",[s._v("route")]),s._v(" 可以查看路由表，不过这个命令比较老一点：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# route -n")]),s._v("\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".16.1       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         UG    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" eth0\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".16.0       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".252.0   U     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" eth0\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".0.0     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".0.0     U     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" eth0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("传输层工具里介绍的 "),n("strong",[s._v("netstat")]),s._v("，其实也能帮我们查看路由，只要加上 "),n("code",[s._v("-r")]),s._v(" 参数：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -r")]),s._v("\nKernel IP routing table\nDestination     Gateway         Genmask         Flags   MSS Window  irtt Iface\ndefault         gateway         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         UG        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" eth0\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".16.0       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".252.0   U         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" eth0\nlink-local      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".0.0     U         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" eth0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("前面说过，netstat 是被 ss 和 ip 这两个命令替代了。所以我们同样可以用 "),n("strong",[s._v("ip 命令")]),s._v("查看路由。比如这样：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip route")]),s._v("\ndefault via "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".16.1 dev eth0 \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".16.0/22 dev eth0 proto kernel scope "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" src "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".16.7 \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".0.0/16 dev eth0 scope "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" metric "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"数据链路层和物理层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#数据链路层和物理层"}},[s._v("#")]),s._v(" 数据链路层和物理层")]),s._v(" "),n("p",[s._v("这一层离应用层已经很远了，一般来说是专职的网络团队在负责。如果这一层有问题，就会直接体现在网络层表现上面，比如 IP 会有丢包和延迟等现象，然后会引发传输层异常（如丢包、乱序、重传等）。所以，"),n("strong",[s._v("一个稳定的数据链路层乃至物理层，是网络可靠性的基石")]),s._v("。")]),s._v(" "),n("p",[s._v("你可能会奇怪：既然底下这两层的稳定性如此重要，那上层的 TCP 不是号称还有传输可靠性的保障吗？难道这种保障形同虚设？")]),s._v(" "),n("p",[s._v("其实，这两点并不矛盾。TCP 的传输可靠性是通过序列号、确认号、重传机制等来保证的，通过这种机制，TCP 可以在"),n("strong",[s._v("一定程度")]),s._v("的网络不稳定场景下，依然保证传输可靠，但不等于 TCP 可以无限容忍底层的不稳定，因为各种 TCP 拥塞控制算法都会由于这种问题，而极大地降低传输性能。如果你想查看这两层的状况，可以用 ethtool 这个工具。比如这样：")]),s._v(" "),n("p",[s._v("如果想查看这两层的状况，可以用 "),n("strong",[s._v("ethtool")]),s._v(" 这个工具，它是用于查询及设置网卡参数的命令。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-a 查看网卡中接收模块RX、发送模块TX 和 Autonegotiate 模块的状态：启动on 或 停用off。\n-A 修改网卡中接收模块RX、发送模块TX 和 Autonegotiate 模块的状态：启动on 或 停用off。\n-c display the Coalesce(聚合、联合) information of the specified ethernet card.聚合网口信息，使看起来更有规律。\n-C Change the Coalesce setting of the specified ethernet card.修改网卡聚合信息。\n-g Display the rx/tx ring parameter information of the specified ethernet card. 显示网卡的接收/发送环形参数。\n-G Change the rx/tx ring setting of the specified ethernet card. 修改网卡的接收/发送环形参数。\n-i 显示网卡驱动的信息，如驱动的名称、版本等。\n-d 显示 register dump 信息，部分网卡驱动不支持该选项。\n-e 显示 EEPROM dump 信息，部分网卡驱动不支持该选项。\n-E 修改网卡 EEPROM byte。\n-k 显示网卡 Offload 参数的状态：on 或 off，包括 rx-checksumming、tx-checksumming 等。\n-K 修改网卡 Offload 参数的状态。\n-p 用于区别不同 ethX 对应网卡的物理位置，常用的方法是使网卡 port 上的 led 不断的闪；N 指示了网卡闪的持续时间，以秒为单位。\n-r 如果 auto-negotiation 模块的状态为 on，则 restarts auto-negotiation.\n-s 修改网卡的部分配置，包括网卡速度、单工/全双工模式、mac 地址等。加上 -s 选项修改的内容才会生效。\n-S 显示 NIC- and driver-specific 的统计参数，如网卡接收/发送的字节数、接收/发送的广播包个数等。\n-t 让网卡执行自我检测，有两种模式：offline or online。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("查询网口的驱动相关信息：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ethtool -i eth0")]),s._v("\ndriver: virtio_net\nversion: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0\nfirmware-version: \nexpansion-rom-version: \nbus-info: 0000:00:05.0\nsupports-statistics: no\nsupports-test: no\nsupports-eeprom-access: no\nsupports-register-dump: no\nsupports-priv-flags: no\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("它的原理，是网卡驱动会到内核中注册 ethtool 回调函数，然后我们用 ethtool 命令就可以查看这些信息了。由于信息是由网卡驱动提供的，所以十分「接地气」。")]),s._v(" "),n("p",[s._v("如果你在传输层和网络层的排查工具上，已经看到明确的链路不稳定的信息，那就直接找网络团队去处理吧。")]),s._v(" "),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("p",[s._v("总结网络各层的常用排查工具如下：")]),s._v(" "),n("div",{staticStyle:{"text-align":"center"}},[n("img",{attrs:{src:a(484),alt:"网络各层常用排查工具"}}),s._v(" "),n("p",{staticStyle:{"text-align":"center",color:"#888"}},[s._v("（网络各层常用排查工具）")])]),s._v(" "),n("p",[s._v("（完）")])])}),[],!1,null,null,null);t.default=e.exports}}]);