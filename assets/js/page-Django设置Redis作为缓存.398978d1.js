(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{737:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"django-设置-redis-作为缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#django-设置-redis-作为缓存"}},[s._v("#")]),s._v(" Django 设置 Redis 作为缓存")]),s._v(" "),a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),a("p",[s._v("如果是工具类小项目，一般用不到缓存。因为在项目设计的过程中应当尽量减少依赖，不过度设计，以实现需求为目标，尽量让项目简单，这样协作的小伙伴看起代码来不费劲，出了问题还容易查找原因。所以正常情况下一个数据库（MySQL）就足够了。")]),s._v(" "),a("p",[s._v("但很多时候随着使用频率的增加，出于性能优化的考虑，数据库已无法满足需求，增加缓存就很有必要了。")]),s._v(" "),a("p",[s._v("所谓的缓存，就是把数据库中不常变化的数据提取出来，临时存放到一个第三方存储介质中。在一定的时间内有用户来访问这些数据时，不需要再去执行数据库操作，直接从缓存中取得数据，这样将大大降低对数据库的消耗，且缓存大都使用内存来存储，读写效率极高。")]),s._v(" "),a("p",[s._v("Django 支持的缓存类型有：")]),s._v(" "),a("ul",[a("li",[s._v("Memcached：它是 Django 原生支持的缓存系统，不过 Memcached 不是 Django 自带的软件，而是一个独立的软件，需要另外安装、配置和启动服务。")]),s._v(" "),a("li",[s._v("数据库缓存：我们使用缓存的很大原因就是要减少数据库的操作，如果将缓存又存到数据库，就有点奇怪了。但也有特例：比如你有一个高速、高效索引的数据库。")]),s._v(" "),a("li",[s._v("文件系统缓存：连数据库我们都觉得慢，那么基于文件系统显然更慢。不过在没有 Redis、Memcached 和数据库的时候，可以凑活着用一下。")]),s._v(" "),a("li",[s._v("本地内存缓存：如果本地主机内存够大够快，也可以直接使用它作为缓存，并且这也是 Django 默认使用的缓存后端。")]),s._v(" "),a("li",[s._v("开发用的虚拟缓存：仅用于开发模式，只是实现缓存接口，并不做其他操作，等正式部署的时候不会用这种缓存，但开发好的 API 就不用做什么大的修改了。")]),s._v(" "),a("li",[s._v("自定义的缓存后台，自己写一个缓存后端，或者接入 Redis 第三方缓存。")])]),s._v(" "),a("p",[s._v("这里不多介绍，配置和使用示例可以看"),a("a",{attrs:{href:"%5Bhttps://docs.djangoproject.com/en/dev/topics/cache/%5D"}},[s._v("官方文档")]),s._v("。")]),s._v(" "),a("p",[s._v("因为正常情况下我们的环境中肯定会安装 Redis（就算不是当前服务用，也会有别的模块用），所以就采用 Redis 来做缓存了。")]),s._v(" "),a("h2",{attrs:{id:"安装配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装配置"}},[s._v("#")]),s._v(" 安装配置")]),s._v(" "),a("p",[s._v("Redis 的安装参考 "),a("RouterLink",{attrs:{to:"/backend-knowledge/redis/installation-of-redis/"}},[s._v("Redis 的安装与卸载")]),s._v("，另外要想在 Django 中使用 Redis 缓存，则需要先安装依赖：")],1),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" django-redis\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("接着在 settings.py 配置：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("CACHES "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BACKEND"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"django_redis.cache.RedisCache"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"LOCATION"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"redis://:密码@127.0.0.1:6379/1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TIMEOUT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存的默认过期时间，默认是 300s，None 表示永不过期")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OPTIONS"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CLIENT_CLASS"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"django_redis.client.DefaultClient"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SOCKET_CONNECT_TIMEOUT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SOCKET_TIMEOUT"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CONNECTION_POOL_KWARGS"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"max_connections"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IGNORE_EXCEPTIONS"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"COMPRESSOR"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"django_redis.compressors.zlib.ZlibCompressor"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# "PASSWORD": "密码",')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("配置完后就可以使用缓存了。")]),s._v(" "),a("h2",{attrs:{id:"全站-视图-模板缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全站-视图-模板缓存"}},[s._v("#")]),s._v(" 全站/视图/模板缓存")]),s._v(" "),a("p",[s._v("Django 提供不同级别的缓存粒度：可以缓存特定的视图，也可以只缓存部分模板片段，还可以缓存整个网站。")]),s._v(" "),a("p",[s._v("但现在一般都是前后端分离项目，所以这几类都不是目前我想要的，需要了解以上几类缓存的话可以参考官网，里面写的很详细。")]),s._v(" "),a("p",[s._v("这里我需要的是 Django 提供的底层缓存 API，可以使用这些 API 来读写缓存的数据。")]),s._v(" "),a("h2",{attrs:{id:"缓存-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存-api"}},[s._v("#")]),s._v(" 缓存 API")]),s._v(" "),a("p",[s._v("开启 Django Cache 配置后，就可以使用缓存服务了，基本用法如下")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cache "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" cache\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("获取到 "),a("code",[s._v("cache")]),s._v(" 实例后，就可以使用 Redis 命令来操作缓存了，例如：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" from django.core.cache "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" cache\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" cache.set"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" cache.ttl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("其它 API 其实可以参考 Redis 的操作命令，因为 "),a("a",{attrs:{href:"https://github.com/jazzband/django-redis",target:"_blank",rel:"noopener noreferrer"}},[s._v("django-redis"),a("OutboundLink")],1),s._v(" 这个模块提供了对 Redis 客户端的原始访问，它重写了文件缓存类中的所有方法。")]),s._v(" "),a("p",[s._v("也可以通过拿到 Redis 的链接操作 Redis 数据库，跟直接操作 Redis 数据库的语法一样：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" from django_redis "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" get_redis_connection\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" con "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get_redis_connection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" con\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("redis.client.Redis object at 0x2dc451"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("（完）")])])}),[],!1,null,null,null);t.default=e.exports}}]);